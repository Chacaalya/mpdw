---
title: "Tugas Mandiri 2_Data IPM_ Chaca Alya Fahrani_039"
author: "Chaca Alya Fahrani"
date: "2025-08-28"
output: html_document
---

## Import Data IPM

```{r}
library(readxl)
data_ipm <- read_xlsx("C:/Users/chaca/OneDrive/Desktop/Dokumen/Data Latihan Ipm Bandung (mpdw).xlsx")
data_ipm
```

## **Mengubah data agar terbaca sebagai data deret waktu**

```{r}
df.ts <- ts(data_ipm$Y)
```

## **Membuat plot data deret waktu**

```{r}
ts.plot(df.ts, xlab="Time Periode ", ylab="IPM", 
        main = "Time Series Plot")
points(df.ts)
```

## Membuat Model Awal

```{r}
model <- lm(Y ~ X, data = data_ipm)
summary(model)
```

**Observasi Awal:** Berdasarkan hasil model regresi, didapatkan **Nilai Adjusted R-squared yang sangat tinggi (0.9662)** dan koefisien `tahun (X)` **sangat signifikan (p-value \< 0.001)**. Hasil ini menunjukkan model yang terlihat meyakinkan, namun analisis tidak berhenti pada tahap ini saja.

## **Eksplorasi Kondisi**

### Plot Residual vs Order

```{r}
# Ambil sisaan dari model
sisaan_awal <- residuals(model)

# Plot sisaan terhadap waktu
plot(data_ipm$X, sisaan_awal, type="o", pch=20, col="red",
     main="Plot Sisaan vs Order", xlab="Tahun", ylab="Sisaan")
abline(h=0, lty=2) # Garis referensi di y=0
```

Jika kita lihat, plot sisaan vs order membentuk suatu pola tertentu yang mengindikasikan sisaan saling bebas (adanya autokorelasi)

### Plot ACF

```{r}
res <- residuals(model)
acf(res, main="ACF Residual")
```

Pada plot ACF residual terlihat adanya garis vertikal yang melewati batas signifikansi, yang menunjukkan bahwa residual mengandung autokorelasi.

Berdasarkan eksplorasi kondisi melalui plot residual vs fitted maupun plot ACF, terlihat bahwa sisaan mengandung autokorelasi. Namun, untuk memperkuat kesimpulan tersebut diperlukan uji formal, yaitu menggunakan uji Durbin-Watson.

## Uji Formal Durbin-Watson

-   **H0 (Hipotesis Nol)**: Tidak ada autokorelasi. Sisaan saling bebas.

-   **H1 (Hipotesis Alternatif)**: Ada autokorelasi.

```{r}
library(lmtest)
dwtest(model)
```

**Kesimpulan:** P-value yang dihasilkan **sangat kecil (0.00001578)**, yaitu di bawah tingkat signifikansi 0.05. Dengan demikian, **tolak H0**, sehingga terdapat bukti yang kuat bahwa sisaan model mengalami autokorelasi."

## Penanganan Autokorelasi

### Metode 1: Cochrane-Orcutt

```{r}
library(orcutt)
model_orcutt <- cochrane.orcutt(model)
summary(model_orcutt)

# rho paling optimum
rho <- model_orcutt$rho
cat("Rho optimum:", rho)
```

**Hasil Penanganan Menggunakan Cochrane-Orcutt :** nilai **rho** optimum yang dihasilkan sebesar 0.7994567. Nilai ini merupakan "dosis" yang digunakan untuk memperbaiki model. Selain itu, jika dilihat statistik **Durbin-Watson yang baru**, Nilainya sekarang jauh lebih dekat ke 2, dan p-value-nya (\> 0.05) menunjukkan bahwa **autokorelasi sudah berhasil diatasi**.

**Verifikasi Manual:**

```{r}
ipm_trans <- data_ipm$Y[-1] - data_ipm$Y[-11]*rho

tahun_trans <- data_ipm$X[-1] - data_ipm$X[-11]*rho
model_co_manual <- lm(ipm_trans~tahun_trans)

b0_co_manual <- coef(model_co_manual)[1]/(1-rho)
b1_co_manual <- coef(model_co_manual)[2]
cat("Koefisien manual Cochrane-Orcutt:\n")
cat("b0:", b0_co_manual, "\n")
cat("b1:", b1_co_manual, "\n")
```

**Perhatikan:** Hasil koefisien manual sangat mirip dengan hasil dari fungsi otomatis (model orcutt) yang sebelumnya sudah didapatkan.

### Metode 2: Hildreth-Lu

```{r}
#Penanganan Autokorelasi Hildreth lu
# Hildreth-Lu
hildreth.lu.func<- function(r, model){
  x <- model.matrix(model)[,-1]
  y <- model.response(model.frame(model))
  n <- length(y)
  t <- 2:n
  y <- y[t]-r*y[t-1]
  x <- x[t]-r*x[t-1]
  
  return(lm(y~x))
}

#Pencariab rho yang meminimumkan SSE
r <- c(seq(0.1,0.9, by= 0.1))
tab <- data.frame("rho" = r, "SSE" = sapply(r, function(i){deviance(hildreth.lu.func(i, model))}))
round(tab, 4)
```

Pertama-tama akan dicari di mana kira-kira ρ yang menghasilkan SSE minimum. Pada hasil di atas terlihat ρminimum ketika 0.8. Namun, hasil tersebut masih kurang teliti sehingga akan dicari kembali ρ yang lebih optimum dengan ketelitian yang lebih. Jika sebelumnya jarak antar ρ yang dicari adalah 0.1, kali ini jarak antar ρ adalah 0.001 dan dilakukan pada selang 0.7 sampai dengan 0.9.

```{r}
#Rho optimal di sekitar 0.8
rOpt <- seq(0.7,0.9, by= 0.001)
tabOpt <- data.frame("rho" = rOpt, "SSE" = sapply(rOpt, function(i){deviance(hildreth.lu.func(i, model))}))
head(tabOpt[order(tabOpt$SSE),])
```

Dari hasil ini, didapatkan nilai rho = 0.800 yang menghasilkan nilai SSE terkecil sebesar 0.1706261.

```{r}
#Grafik SSE optimum
par(mfrow = c(1,1))
plot(tab$SSE ~ tab$rho , type = "l", xlab = "Rho", ylab = "SSE")
abline(v = tabOpt[tabOpt$SSE==min(tabOpt$SSE),"rho"], lty = 2, col="red",lwd=2)
text(x=0.800, y=0.1706261, labels = "rho=0.800", cex = 0.8)
```

### Model Hildreth-Lu

```{r}
library(HoRM)
model_hl <- hildreth.lu(data_ipm$Y, data_ipm$X, rho = 0.800)
summary(model_hl)
```

```{r}
#Transformasi Balik
cat("y = ", coef(model_hl)[1]/(1-0.800), "+", coef(model_hl)[2],"x", sep = "")
```

```{r}
#Deteksi autokorelasi
dwtest(model_hl)
```

**Kesimpulan:** P-value yang dihasilkan **sudah melebihi tingkat signifikan \> 0.05 (0.2349)**, sehingga sisaan model sudah tidak mengalami autokorelasi."

```{r}
# Menghitung SSE untuk setiap model secara manual
sse_awal <- sum(residuals(model)^2)
sse_co <- sum(residuals(model_orcutt)^2)
sse_hl <- sum(residuals(model_hl)^2)

# Membuat tabel perbandingan
data.frame(
  Metode = c("Model Awal (Sakit)", "Cochrane-Orcutt (Sehat)", "Hildreth-Lu (Sehat)"),
  SSE = c(sse_awal, sse_co, sse_hl),
  DW_Statistic = c(dwtest(model)$statistic, model_orcutt$DW[3], dwtest(model_hl)$statistic)
)

```

**Kesimpulan Perbandingan Metode:** Penerapan metode Cochrane-Orcutt memang dapat menghilangkan autokorelasi, tetapi justru meningkatkan nilai SSE. Sebaliknya, metode Hildreth-Lu tidak hanya berhasil mengatasi autokorelasi, tetapi juga menghasilkan nilai SSE yang lebih kecil. Dengan demikian, metode Hildreth-Lu dapat dikatakan lebih baik dibandingkan Cochrane-Orcutt dalam perbaikan model pada data IPM ini.
